# コンペ概要（あらすじから元ネタ作品IDを当てる）

## 目的
LLMが生成した「架空作品のあらすじ」から、元ネタになった実在の有名作品（映画・アニメ・漫画）を2作品推定する。  
文章には複数作品の世界観やテーマが混ざっており、これを機械的に推定するモデルを作る。

## タスク
- 候補作品：50作品（ID付き、カテゴリ・タイトル・あらすじが公開）
- 予測対象：架空作品 340件
- 各架空作品は、候補50作品から2作品を選んで合成したもの
- 各架空作品について、元ネタ作品IDを2つ予測し、CSVで提出する

## データセット構成
- `base_stories.tsv`  
  候補作品（50作品）の情報（`id`, `category`, `title`, `story`）

- `fictionstoriespractice.tsv`  
  練習用データ（20件、ラベルあり：`id_a`, `id_b`）

- `fictionstoriestest.tsv`（/ `.csv`）  
  評価用データ（ラベルなし：`id`, `story`）

## 評価指標
- accuracy（正解率）
- 予測した「作品IDのペア」が完全一致した場合に正解
- 2作品の順序は問わない（例：正解が (1,2) なら (2,1) も正解）
- 片方だけ一致は不正解（例：正解 (1,2) に対して (1,3) は不正解）

---

# 手法

## 手法1：埋め込みベース

### 1-1. 1対1で類似度比較
候補50作品それぞれの埋め込みと、評価データ（架空あらすじ）の埋め込みを比較し、スコアが高い上位2作品を予測として採用。

| モデル | publicスコア | privateスコア |
| --- | ---: | ---: |
| intfloat/multilingual-e5-base | 0.09803921568627451 | 0.07647058823529412 |
| cl-nagoya/ruri-v3-310m | 0.08823529411764706 | 0.1264705882352941 |

### 1-2. 2作品の合成埋め込みで全探索
候補50作品から2作品を選ぶ全組合せ（50C2）について、2作品の埋め込みを平均などで合成し、評価データと比較して最も近いペアを選ぶ。

| モデル | publicスコア | privateスコア |
| --- | ---: | ---: |
| intfloat/multilingual-e5-base | 0.10784313725490197 | 0.07647058823529412 |

---

## 手法2：LLM推論（WebUI）ベース

### 2-1. 候補50作品＋練習事例を与えて推論
候補作品一覧（50作品）と練習事例（20件、正解ラベル付き）をプロンプトに含め、テストデータのあらすじから元ネタ2作品（ID）を選ばせる。

#### 手順（10件ずつ）
1. 候補作品一覧（50作品）を入力
2. 練習事例（20件）を入力
3. テストデータを10件入力し、CSV形式で10行の予測を出力
4. 340件を10件ずつに分けて繰り返し、提出用CSVを作成（34回）

#### 出力形式
- CSVのみ（ヘッダなし）
- 1行 = `id,pred_a,pred_b`
- 説明・理由は出さない

#### スコア
| LLM | 事例 | publicスコア | privateスコア |
| --- | --- | ---: | ---: |
| gpt5.2-thinking | 0件 | 0.4019607843137255 | 0.4117647058823529 |
| gpt5.2-thinking | 20件 | 0.49019607843137253 | 0.4764705882352941 |
| gemini3-flash（高速モード） | 20件 | 0.46078431372549017 | 0.45588235294117646 |

### 2-2. 2モデルの予測が一致しない行だけ再推論
gpt5.2-thinking と gemini3-flash の予測結果を比較し、2モデルの予測が一致しないデータだけを抽出して再推論した。  
再推論した行は、元の提出ファイルの該当箇所に置き換えて提出ファイルを作成した。

再推論では、各データに対して以下を入力として付与した。
- `pred_1`（モデル1の予測）
- `pred_2`（モデル2の予測）
- `overlap_count`（共通ID数）
- `overlap_ids`（共通ID）

#### 出力形式
- CSVのみ（ヘッダなし）
- 1行 = `id,pred_a,pred_b`
- 説明・理由は出さない

#### スコア
| LLM | 事例 | publicスコア | privateスコア |
| --- | --- | ---: | ---: |
| gpt5.2-thinking | 20件 | 0.4803921568627451 | 0.48823529411764705 |
| gemini3-flash（高速モード） | 20件 | 0.5294117647058824 | 0.5147058823529411 |

---

## 感想
- 卒論と学会への論文投稿と時期が重なり、まとまった時間を確保できなかった。
- 埋め込みベースは改善の余地があると思って色々試したかったが、スコアがかなり低く、他の参加者の報告でも埋め込みベースは伸びにくかったらしい。
- 商用LLMの利用がOKで、結局は課金できる人が有利になりやすいルールだった。学生限定コンペとしてはあまり良くない設定だと思った。
- 自分は課金したくなかったのでAPIは使わず、WebUIで10件ずつ回して提出データを作っていたので手間が大きかった。
